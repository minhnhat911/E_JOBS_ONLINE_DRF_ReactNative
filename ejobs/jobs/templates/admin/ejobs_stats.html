{% extends "admin/base_site.html" %}
{% load static %}

{% block title %}
B√°o c√°o & Th·ªëng k√™ h·ªá th·ªëng | E-JOBS
{% endblock %}

{% block content %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<h1 class="page-title">üìä B√°o c√°o & Th·ªëng k√™ h·ªá th·ªëng E-JOBS</h1>

<form method="get">
    <label><strong>Ch·ªçn nƒÉm th·ªëng k√™:</strong></label>

    <select name="year" onchange="this.form.submit()" class="year-select">
        {% for y in years %}
            <option value="{{ y }}"
                {% if y == selected_year %}selected{% endif %}>
                {{ y }}
            </option>
        {% endfor %}
    </select>
</form>


<!-- ===== KPI ===== -->
<div class="dashboard">
    <div class="dashboard-card blue">
        <span>T·ªïng tin tuy·ªÉn d·ª•ng</span>
        <strong>{{ total_jobs }}</strong>
    </div>

    <div class="dashboard-card orange">
        <span>T·ªïng ·ª©ng vi√™n</span>
        <strong>{{ total_candidates }}</strong>
    </div>

    <div class="dashboard-card green">
        <span>H·ªì s∆° ·ª©ng tuy·ªÉn</span>
        <strong>{{ total_applications }}</strong>
    </div>
</div>

<hr>

<!-- ===== BI·ªÇU ƒê·ªí ===== -->
<div class="charts">
    <div class="chart-box">
        <canvas id="jobsChart"></canvas>
    </div>

    <div class="chart-box">
        <canvas id="revenueChart"></canvas>
    </div>
</div>

<hr>

<div class="tables">
    <section>
        <h2>üìÖ Tin tuy·ªÉn d·ª•ng theo th√°ng ({{ selected_year }})</h2>
        <table class="admin-table">
            <tr><th>Th√°ng</th><th>S·ªë tin</th></tr>
            {% for item in jobs_by_month %}
            <tr>
                <td>{{ item.month|date:"m/Y" }}</td>
                <td>{{ item.total }}</td>
            </tr>
            {% empty %}
            <tr><td colspan="2">Kh√¥ng c√≥ d·ªØ li·ªáu</td></tr>
            {% endfor %}
        </table>
    </section>

    <section>
        <h2>üí∞ Doanh thu theo th√°ng ({{ selected_year }})</h2>
        <table class="admin-table">
            <tr><th>Th√°ng</th><th>Doanh thu (VNƒê)</th></tr>
            {% for item in revenue_by_month %}
            <tr>
                <td>{{ item.month|date:"m/Y" }}</td>
                <td class="money">{{ item.total|floatformat:0 }}</td>
            </tr>
            {% empty %}
            <tr><td colspan="2">Kh√¥ng c√≥ d·ªØ li·ªáu</td></tr>
            {% endfor %}
        </table>
    </section>
</div>

<section style="margin-top: 30px;">
    <h2>üìà Doanh thu theo nƒÉm</h2>
    <table class="admin-table small">
        <tr><th>NƒÉm</th><th>T·ªïng doanh thu</th></tr>
        {% for item in revenue_by_year %}
        <tr>
            <td>{{ item.year|date:"Y" }}</td>
            <td class="money">{{ item.total|floatformat:0 }}</td>
        </tr>
        {% endfor %}
    </table>
</section>


<style>
.page-title { margin-bottom: 20px; }

.year-select {
    padding: 6px 10px;
    border-radius: 4px;
}

.dashboard {
    display: flex;
    gap: 20px;
    margin-bottom: 30px;
}
.dashboard-card {
    flex: 1;
    background: #fff;
    padding: 20px;
    border-left: 5px solid;
    box-shadow: 0 2px 4px rgba(0,0,0,.05);
}
.dashboard-card strong {
    display: block;
    font-size: 26px;
    margin-top: 5px;
}
.blue { border-color: #3498db; }
.orange { border-color: #e67e22; }
.green { border-color: #2ecc71; }

.charts {
    display: flex;
    gap: 20px;
    margin-bottom: 30px;
}
.chart-box {
    flex: 1;
    background: #fff;
    padding: 20px;
    height: 350px;
    border: 1px solid #eee;
}

.tables {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 30px;
}

.admin-table {
    width: 100%;
    border-collapse: collapse;
}
.admin-table th, .admin-table td {
    border: 1px solid #eaeaea;
    padding: 10px;
}
.admin-table th {
    background: #f5f5f5;
}
.admin-table.small {
    max-width: 450px;
}
.money {
    color: #27ae60;
    font-weight: bold;
}
</style>

<!-- ===== SCRIPT ===== -->
<script>
new Chart(jobsChart, {
    type: 'line',
    data: {
        labels: [{% for i in jobs_by_month %}"{{ i.month|date:'m/Y' }}",{% endfor %}],
        datasets: [{
            label: 'Tin tuy·ªÉn d·ª•ng',
            data: [{% for i in jobs_by_month %}{{ i.total }},{% endfor %}],
            borderColor: '#3498db',
            fill: true,
            tension: .4
        }]
    }
});

new Chart(revenueChart, {
    type: 'bar',
    data: {
        labels: [{% for i in revenue_by_month %}"{{ i.month|date:'m/Y' }}",{% endfor %}],
        datasets: [{
            label: 'Doanh thu',
            data: [{% for i in revenue_by_month %}{{ i.total }},{% endfor %}],
            backgroundColor: '#2ecc71'
        }]
    }
});
</script>

{% endblock %}
